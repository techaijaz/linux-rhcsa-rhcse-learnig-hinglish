Day 29: Install Ansible, configure control node, inventory
---
नमस्ते future Linux experts aur automation ke maharathiyon!

Aaj hum ek bahut hi important topic par discuss karenge jo aapke RHCSA aur RHCE certifications ke liye foundation banayega: **Ansible Installation, Control Node Setup, aur Inventory Configuration**. Yeh aapke life ko as a System Administrator, DevOps Engineer, ya Cloud Engineer bahut easy banane wala hai. Chaliye shuru karte hain!

---

## ������ RHCSA + RHCE Training Lesson: Ansible Setup - Control Node & Inventory

### 1. Concept Explanation (Hinglish)

Dekho, modern IT infrastructure itna complex ho gaya hai ki har server ko manually manage karna impossible hai. Imagine karo, aapke paas 100 servers hain aur sab par ek software install karna hai ya ek config file change karni hai. Agar aap ek-ek server par jaakar karte hain, toh pura din lag jayega aur galti hone ke chances bhi high honge. Yahi par entry hoti hai hamare hero ki: **Ansible!**

**Ansible Kya Hai?**
Ansible ek open-source **automation engine** hai. Matlab, yeh ek tool hai jo aapke repetitive tasks ko automate karta hai. Yeh specially design kiya gaya hai **configuration management, application deployment, task automation, aur orchestration** ke liye.
*   **Agentless:** Sabse badi baat, Ansible ko managed nodes (jin servers par aap kaam karna chahte hain) par koi special software ya "agent" install karne ki zaroorat nahi padti. Yeh sirf standard SSH (Secure Shell) use karke connect hota hai. So simple!
*   **Idempotent:** Iska matlab hai ki aapke commands ya configurations kitni baar bhi run hon, system ki state wahi rahegi jo aap chahte hain. Agar ek service already started hai, toh Ansible use dobara start karne ki koshish nahi karega.
*   **Simple to Learn:** YAML (Yet Another Markup Language) format mein likha jata hai, jo bahut readable aur easy to understand hai.
*   **Python-based:** Isliye bahut flexible hai aur easily extendable hai.

**Control Node:**
*   Control Node woh server hota hai **jahan se aap Ansible commands chalate hain**. Matlab, Ansible software isi machine par install hota hai.
*   Isi machine se baaki saare servers (jinhe hum 'Managed Nodes' ya 'Hosts' kehte hain) ko control kiya jata hai.
*   Aapko Control Node par **SSH access** hona chahiye aur wahan se managed nodes tak passwordless SSH communication set up karna hota hai.

**Managed Nodes (Hosts):**
*   Yeh woh servers hain **jin par aap Ansible se tasks run karwate hain**. Jaise aapke web servers, database servers, application servers, etc.
*   Inpar koi extra software install nahi karna hota. Bas, inpar **Python** aur **SSH server** running hona chahiye. RHEL/CentOS systems par yeh by default hota hai.

**Inventory:**
*   Inventory ek file hoti hai (mostly INI ya YAML format mein) jisme aap apne **managed nodes ki list** rakhte hain. Matlab, Ansible ko kaise pata chalega ki kis-kis server par kaam karna hai? Woh inventory file se pata karta hai.
*   Ismein aap servers ko groups mein divide kar sakte hain (e.g., `[webservers]`, `[dbservers]`), aur har server ya group ke liye specific variables bhi define kar sakte hain.
*   Default inventory file path `/etc/ansible/hosts` hota hai, but aap custom inventory files bhi bana sakte hain.

**RHCSA / RHCE Connection:**
*   **RHCSA** level par aapko basic Ansible installation, configuration, aur ad-hoc commands chalana aana chahiye.
*   **RHCE** level par toh Ansible puri tarah se center stage par hota hai. Aapko complex playbooks likhna, roles create karna, vault use karna, aur dynamic inventory configure karna padega. Isliye, Control Node aur Inventory ka concept bahut clear hona zaroori hai.

### 2. Key Linux Commands (Hinglish)

Chaliye, ab dekhte hain kaun se commands aapko pakad ke rakhne hain:

*   **`sudo dnf install ansible -y`**
    *   **Explanation:** RHEL-based systems (jaise CentOS, Fedora, AlmaLinux, Rocky Linux) par Ansible install karne ka command. `dnf` ek package manager hai (jo `yum` ka advanced version hai). `sudo` administrator privileges ke liye, aur `-y` matlab saare prompts par "yes" automatically choose kar dega.
    *   **Hinglish:** "Is command se hum apne RHEL-based Control Node par Ansible software install karte hain. `dnf` hamara package manager hai, aur `-y` option lagane se installation ke dauran aane wale sabhi confirmation prompts par 'yes' apne aap ho jata hai."

*   **`ansible --version`**
    *   **Explanation:** Ansible install hone ke baad, yeh check karne ke liye ki woh sahi se install hua hai aur uska kaun sa version hai, is command ka use karte hain.
    *   **Hinglish:** "Ansible install hone ke baad, uski version check karne aur confirm karne ke liye ki sab theek hai, hum yeh command chalate hain."

*   **`ssh-keygen`**
    *   **Explanation:** Yeh command Control Node par SSH key pair (public key aur private key) generate karta hai. Passwordless SSH communication ke liye yeh step bahut zaroori hai.
    *   **Hinglish:** "Control Node par SSH keys (public aur private) banane ke liye yeh command use hota hai. Passwordless login ke liye yeh keys bahut important hain."

*   **`ssh-copy-id ansible_user@managed_node_ip`**
    *   **Explanation:** Is command se Control Node ki public key ko managed node par copy kiya jata hai. `ansible_user` woh user hai jiske through aap managed node par login karna chahte hain, aur `managed_node_ip` us server ka IP address hai. Iske baad, aap bina password ke SSH kar payenge.
    *   **Hinglish:** "Yeh command Control Node ki public key ko target managed node par copy karta hai, taki hum bina password ke SSH kar sakein. `ansible_user` us user ka naam hai jiske through login karenge, aur `managed_node_ip` server ka IP address."

*   **`vi /etc/ansible/hosts` or `vi ~/my_inventory`**
    *   **Explanation:** Yeh command inventory file ko edit karne ke liye hai. `vi` ek text editor hai. Aap default inventory file (`/etc/ansible/hosts`) ko edit kar sakte hain ya apni custom inventory file bana sakte hain.
    *   **Hinglish:** "Inventory file ko edit karne ke liye, jahan hum apne servers ki list rakhte hain, hum `vi` editor ka use karte hain. Aap default file ya apni khud ki banayi hui file edit kar sakte ho."

*   **`ansible all -m ping`**
    *   **Explanation:** Yeh ek ad-hoc command hai. `ansible` command, `all` matlab inventory ke saare hosts par, `-m ping` matlab `ping` module ko run karo. Yeh connectivity check karta hai.
    *   **Hinglish:** "Yeh ek quick command hai jisse hum check karte hain ki Ansible Control Node se saare managed nodes par connectivity sahi hai ya nahi. `all` matlab sabhi hosts par, aur `-m ping` ek Ansible module hai jo connectivity test karta hai."

*   **`ansible webservers -a "systemctl status httpd"`**
    *   **Explanation:** Yeh bhi ek ad-hoc command hai. `webservers` matlab sirf `webservers` group ke hosts par, `-a` matlab "argument" ya "command" run karo. Yahan hum `systemctl status httpd` command run kar rahe hain.
    *   **Hinglish:** "Agar aapko kisi specific group (jaise `webservers`) par koi command run karni hai, toh aap `-a` option ke saath woh command specify karte ho. Yahan hum `httpd` service ka status check kar rahe hain."

### 3. Step-by-Step Examples (Hinglish)

Chaliye, ek real-world scenario dekhte hain. Hamare paas teen VMs hain:
*   **Control Node:** `192.168.1.100` (Ansible yahan install hoga)
*   **Web Server (Managed Node 1):** `192.168.1.101`
*   **DB Server (Managed Node 2):** `192.168.1.102`

Hum chahte hain ki Control Node se web server par Apache install karein aur DB server par MariaDB install karein, bina har server par login kiye.

#### **Setup Prerequisites (Har VM par):**
1.  **Network Configuration:** Ensure all VMs can ping each other.
2.  **SSH Server:** Make sure `sshd` service is running on all managed nodes. `sudo systemctl enable --now sshd`
3.  **User Creation (Managed Nodes par):** Ek common user banao with `sudo` access.
    *   On `192.168.1.101` (Web Server) and `192.168.1.102` (DB Server):
        ```bash
        sudo useradd -m ansible_user
        sudo passwd ansible_user # Set a strong password
        echo "ansible_user ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/ansible_user # NOPASSWD for convenience in labs, be cautious in production!
        sudo chmod 0440 /etc/sudoers.d/ansible_user # Correct permissions
        ```
        (Agar `NOPASSWD` nahi chahiye toh is line ko skip kar sakte hain aur Ansible chalate time `ansible_become_pass` use kar sakte hain).

---

#### **Step 1: Control Node Setup (Install Ansible)**

1.  **Login to Control Node (`192.168.1.100`).**
2.  **Install EPEL repository (agar needed ho):**
    ```bash
    sudo dnf install epel-release -y
    ```
3.  **Install Ansible:**
    ```bash
    sudo dnf install ansible -y
    ```
4.  **Verify installation:**
    ```bash
    ansible --version
    ```
    *Output mein aapko Ansible version aur other details dikhenge.*

#### **Step 2: Generate SSH Keys on Control Node**

1.  **On Control Node (`192.168.1.100`):**
    ```bash
    ssh-keygen -t rsa -b 4096 # Press Enter for default location and no passphrase for lab
    ```
    *Isse aapki keys `~/.ssh/id_rsa` (private) aur `~/.ssh/id_rsa.pub` (public) ban jayengi.*

#### **Step 3: Copy Public Key to Managed Nodes (Passwordless SSH ke liye)**

1.  **On Control Node (`192.168.1.100`):**
    *   **Copy to Web Server (`192.168.1.101`):**
        ```bash
        ssh-copy-id ansible_user@192.168.1.101
        ```
        *Jab yeh command chalayenge, toh `ansible_user` ka password poochega. Password enter karne ke baad, aapki public key copy ho jayegi.*
    *   **Copy to DB Server (`192.168.1.102`):**
        ```bash
        ssh-copy-id ansible_user@192.168.1.102
        ```
        *Same yahan bhi password enter karein.*

2.  **Test SSH connectivity (from Control Node):**
    ```bash
    ssh ansible_user@192.168.1.101 # Ab bina password ke login hona chahiye
    exit
    ssh ansible_user@192.168.1.102 # Yeh bhi bina password ke login hona chahiye
    exit
    ```
    *Agar bina password ke login ho raha hai, toh you're good to go!*

#### **Step 4: Configure Inventory File**

1.  **On Control Node (`192.168.1.100`):**
    *   Hum ek custom inventory file banayenge apne home directory mein, taki default `/etc/ansible/hosts` file intact rahe.
    ```bash
    vi ~/my_project_inventory
    ```
    *File mein yeh content add karein:*
    ```ini
    [webservers]
    webserver1 ansible_host=192.168.1.101

    [dbservers]
    dbserver1 ansible_host=192.168.1.102

    [all:vars]
    ansible_user=ansible_user
    ansible_ssh_private_key_file=~/.ssh/id_rsa
    ansible_python_interpreter=/usr/bin/python3 # RHEL 8+ uses python3 by default. Ensure python3 is installed on managed nodes.
    ```
    *   **Explanation:**
        *   `[webservers]` and `[dbservers]` are group names.
        *   `webserver1` and `dbserver1` are host aliases (you can name them anything).
        *   `ansible_host` tells Ansible the actual IP address of the server.
        *   `[all:vars]` section mein hum global variables define karte hain jo saare hosts par apply hote hain.
        *   `ansible_user` specify karta hai kis user se SSH login karna hai.
        *   `ansible_ssh_private_key_file` private key ka path batata hai.
        *   `ansible_python_interpreter` specifies the Python executable on managed nodes. RHEL 8/9 by default `python3` use karta hai. Make sure `python3` is present on your managed nodes (`sudo dnf install python3 -y` if not).

#### **Step 5: Test Connectivity with Inventory**

1.  **On Control Node (`192.168.1.100`):**
    *   **Test all hosts:**
        ```bash
        ansible -i ~/my_project_inventory all -m ping
        ```
        *Output mein `SUCCESS` hona chahiye for both hosts.*
    *   **Test webservers group only:**
        ```bash
        ansible -i ~/my_project_inventory webservers -m ping
        ```
        *Only `webserver1` ke liye `SUCCESS` dikhega.*
    *   **Run an ad-hoc command on dbservers group:**
        ```bash
        ansible -i ~/my_project_inventory dbservers -a "uptime"
        ```
        *Isse `dbserver1` ka `uptime` command ka output milega.*
    *   **Install Apache on webserver1:**
        ```bash
        ansible -i ~/my_project_inventory webservers -m dnf -a "name=httpd state=present" --become
        ansible -i ~/my_project_inventory webservers -m systemd -a "name=httpd state=started enabled=yes" --become
        ```
        * `name=httpd state=present` dnf module se `httpd` package install karta hai.
        * `name=httpd state=started enabled=yes` systemd module se `httpd` service start karta hai aur boot par enable karta hai.
        * `--become` option `sudo` use karta hai, kyuki package install aur service management ke liye root privileges chahiye.

Congrats! Aapne Ansible Control Node set up kar liya hai aur inventory file configure karke managed nodes se communicate karna shuru kar diya hai.

### 4. Practice Tasks (Hinglish)

Ab time hai aapke hath gande karne ka! Yeh tasks try karo:

1.  **Fresh Setup:** Apne lab mein 3 fresh VMs banao (Control Node, Server1, Server2).
2.  **Ansible Install:** Control Node par Ansible install karo.
3.  **SSH Key Generation:** Control Node par SSH key pair generate karo.
4.  **User Creation:** Server1 aur Server2 par ek naya user banao (`devops_admin`) aur use `sudo` access do (passwordless `sudo` optional, but lab ke liye helpful).
5.  **Key Copying:** Control Node ki public key ko `devops_admin` user ke liye Server1 aur Server2 par copy karo. Verify karo ki passwordless SSH chal raha hai.
6.  **Custom Inventory:** Apne Control Node par `~/my_lab_inventory.ini` naam ki ek custom inventory file banao.
    *   Ismein do groups banao: `[dev_servers]` aur `[test_servers]`.
    *   Server1 ko `dev_servers` group mein add karo aur Server2 ko `test_servers` group mein add karo.
    *   `[all:vars]` section mein `ansible_user=devops_admin` aur `ansible_ssh_private_key_file=~/.ssh/id_rsa` define karo.
7.  **Connectivity Test:** `ansible -i ~/my_lab_inventory.ini all -m ping` chalao aur verify karo ki sab `SUCCESS` hai.
8.  **Group-specific Ad-hoc Command:**
    *   `dev_servers` group par `hostname` command chalao.
    *   `test_servers` group par `cat /etc/os-release` command chalao.
9.  **Package Installation (RHCSA/RHCE style):**
    *   `dev_servers` par `tmux` package install karo.
    *   `test_servers` par `vim-enhanced` package install karo.
    *   Verify karo ki packages install ho gaye hain (e.g., `ansible -i ~/my_lab_inventory.ini dev_servers -a "rpm -q tmux"`).

### 5. Pro Tips / Common Mistakes (Hinglish)

Kuch important tips aur common mistakes jinse bachna hai:

#### **Pro Tips:**

*   **SSH Agent Use Karo:** Apne Control Node par `eval "$(ssh-agent -s)"` aur `ssh-add ~/.ssh/id_rsa` use karo. Isse baar-baar private key ka password nahi dalna padega agar aapne passphrase set kiya hai.
*   **Inventory Best Practice:** Production environments mein `hosts` file `/etc/ansible/hosts` ko default na rakho. Har project ke liye dedicated `inventory.ini` ya `inventory.yml` file banao aur use `-i` option ke saath specify karo. Ya phir `ansible.cfg` mein `inventory` path set kar do.
*   **Always Test Connectivity:** Koi bhi playbook run karne se pehle, `ansible  -m ping` se connectivity test kar lo.
*   **`ansible_python_interpreter`:** RHEL 8/9 aur uske derivatives par `python3` default interpreter hota hai. Ensure ki aapki `ansible_python_interpreter` variable sahi set hai, warna modules fail ho sakte hain. Managed nodes par `python3` installed hona zaroori hai.
*   **`--check` aur `--diff`:** Playbooks run karte waqt, pehle `--check` option se dry run karo to see what changes *would* be made. `--diff` se aapko exact differences dikhti hain.
*   **`--ask-become-pass`:** Agar aapne `NOPASSWD` sudoers entry nahi banayi hai, toh `ansible` commands ke saath `--become --ask-become-pass` use karo, jahan `sudo` password prompt karega.

#### **Common Mistakes:**

*   **SSH Connectivity Issues:** Yeh sabse common problem hai.
    *   Firewall blocks (port 22 allowed nahi).
    *   Wrong `ansible_user`.
    *   Incorrect permissions on private key (`chmod 600 ~/.ssh/id_rsa` is a must!).
    *   Managed node par SSH server (`sshd`) running nahi hai.
    *   `~/.ssh/authorized_keys` file mein galat public key copy ho gayi hai ya permissions galat hain.
*   **Inventory File Syntax Errors:** INI ya YAML format mein indentation ya typos bahut hote hain. Carefully check karo.
    *   `[group_name]` sahi se define na karna.
    *   Host entries ka galat format.
*   **`ansible_user` Bhul Jaana:** Agar `root` user se connect nahi kar rahe hain, toh `ansible_user` variable set karna bhool jaate hain.
*   **`--become` Forget Karna:** Root privileges ki zaroorat wale tasks (jaise package installation, service management) ke liye `--become` (ya `become: yes` playbook mein) use karna bhool jaate hain.
*   **Python Interpreter Missing/Wrong:** Managed nodes par Python interpreter (usually Python 3) installed nahi hai ya `ansible_python_interpreter` variable galat set hai.
*   **`StrictHostKeyChecking=no` in Production:** Lab mein toh theek hai, but production mein `StrictHostKeyChecking=no` use karna security risk hai. Managed hosts ko `~/.ssh/known_hosts` mein add karna best practice hai.

---

I hope yeh comprehensive lesson aapko Ansible Control Node aur Inventory ko samajhne aur set up karne mein madad karega. Yeh foundations bahut strong honi chahiye RHCSA aur RHCE exams ke liye! All the best! ������
